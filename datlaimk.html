<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  padding:20px;
  display:flex;
  justify-content:center;
}
.box{
  background:white;
  width:100%;
  max-width:380px;
  padding:22px;
  border-radius:14px;
  box-shadow:0 5px 20px rgba(0,0,0,0.15);
}
h2{
  text-align:center;
  margin-bottom:10px;
}
p{
  text-align:center;
  color:#666;
  font-size:14px;
  margin-bottom:20px;
}
input{
  width:100%;
  padding:12px;
  margin-bottom:14px;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:15px;
}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#7b2fff;
  color:white;
  font-size:16px;
  cursor:pointer;
}
#msg{
  margin-top:10px;
  text-align:center;
  font-size:14px;
}
</style>
</head>

<body>
<div class="box">

  <h2>üîê ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u</h2>
  <p>Nh·∫≠p m·∫≠t kh·∫©u m·ªõi c·ªßa b·∫°n ƒë·ªÉ ho√†n t·∫•t vi·ªác kh√¥i ph·ª•c.</p>

  <input type="password" id="pass1" placeholder="M·∫≠t kh·∫©u m·ªõi">
  <input type="password" id="pass2" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u">

  <button id="resetBtn">ƒê·ªïi m·∫≠t kh·∫©u</button>

  <div id="msg"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { 
  getAuth, 
  confirmPasswordReset 
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

// Firebase
const app = initializeApp({
  apiKey: "AIzaSyBhLH36Hz6TI6gmJJTHP1Dztrbdxi9VGGs",
  authDomain: "shopyennhi-6baae.firebaseapp.com"
});

const auth = getAuth(app);

// L·∫•y m√£ oobCode t·ª´ URL Firebase g·ª≠i
const urlParams = new URLSearchParams(window.location.search);
const oobCode = urlParams.get("oobCode");

const msg = document.getElementById("msg");
const btn = document.getElementById("resetBtn");

btn.onclick = async () => {
  const pass1 = document.getElementById("pass1").value;
  const pass2 = document.getElementById("pass2").value;

  msg.style.color = "red";

  if (!pass1 || !pass2) {
    msg.textContent = "Vui l√≤ng nh·∫≠p ƒë·ªß m·∫≠t kh·∫©u!";
    return;
  }

  if (pass1.length < 6) {
    msg.textContent = "M·∫≠t kh·∫©u ph·∫£i t·ª´ 6 k√Ω t·ª±!";
    return;
  }

  if (pass1 !== pass2) {
    msg.textContent = "M·∫≠t kh·∫©u kh√¥ng tr√πng nhau!";
    return;
  }

  // G·ª≠i v·ªÅ Firebase c·∫≠p nh·∫≠t m·∫≠t kh·∫©u
  try {
    await confirmPasswordReset(auth, oobCode, pass1);

    msg.style.color = "green";
    msg.textContent = "‚úî ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng! ƒêang chuy·ªÉn trang...";

    setTimeout(() => {
      window.location.href = "login.html";
    }, 1200);

  } catch (error) {
    msg.textContent = "L·ªói: " + error.message;
  }
};
</script>

</body>
</html>